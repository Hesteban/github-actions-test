name: Level 2 PoC - Data and Secrets

on:
  workflow_dispatch: # Allows manual triggering from the Actions tab

jobs:
  # First Job: Simulates building/compiling your app
  build_job:
    name: Build and Package
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Generate Build File
        run: echo "Build version 1.0.0 generated on $(date)" > build_output.txt

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: production-artifact
          path: build_output.txt

  # Second Job: Simulates deploying that build
  deploy_job:
    name: Deploy to Environment
    runs-on: ubuntu-latest
    needs: build_job # This forces the jobs to run sequentially
    steps:
      - name: Download Artifact
        uses: actions/download-artifact@v4
        with:
          name: production-artifact

      - name: Use Secrets and Display Content
        env:
          MY_SECRET_TOKEN: ${{ secrets.MY_FAKE_TOKEN }}
        run: |
          echo "Connecting to server using token: $MY_SECRET_TOKEN"
          echo "File content from previous job:"
          cat build_output.txt